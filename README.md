# Описание проекта
Проект посвящён анализу данных и решению задачи регрессии (предсказание цен на телефоны) 

[Датасет](https://www.kaggle.com/datasets/iabhishekofficial/mobile-price-classification) 

## Установка и запуск

Для MacOs Linux вместо python использовать python3

**1. Клонировать репозиторий:**
```
git clone https://github.com/KozlovIA/IIS_LR1
```

**2. Перейти в папку проекта:**
```
cd /IIS_LR1/
```

**3. Cоздать и активировать виртуальное окружение:**
```
python -m venv venv
```

Для Windows:
```
venv\Scripts\activate.bat
```

Для MacOs/Linux:
```
source venv/bin/activate
```

**4. Установить зависимости из файла requirements.txt:**
- Обновить пакетный менеджер pip
```
python -m pip install --upgrade pip
```

- Установить зависимости
```
pip install -r requirements.txt
```
**5. Создать папку data и поместить в неё датасет**
```
mkdir data
```
# Исследование данных

### Очистка данных 
- Приведены к категориальному типу: 
['blue',
 'dual_sim',
 'four_g',
 'three_g',
 'touch_screen',
 'wifi',
 'price_range'].
- Приведены к оптимальным числовым видам: 
 ['battery_power',
 'clock_speed',
 'fc',
 'int_memory',
 'm_dep',
 'mobile_wt',
 'n_cores',
 'pc',
 'px_height',
 'px_width',
 'ram',
 'sc_h',
 'sc_w',
 'talk_time']
- Дубликатов не обнаружено
- Удалось добиться уменьшения размера выборки 2 раза, путём приведения данных к более оптимальным типам, которые удалось подобрать за счет метода describe

### Анализ признаков для модели

![](eda/Рапределение_px_height_по_price_range.png 'Зависимость цены числа пикселей по вертикали')

![](eda/Рапределение_px_width_по_price_range.png 'Зависимость цены числа пикселей по горизонтали')

- Таким образом понимаем, что цена на телефоны зависит от плотности пикселей

![](eda/Рапределение_ram_по_price_range.png 'Зависимость цены телефона от размера ОЗУ')

- Телефоны с большим ОЗУ имеют стоимость выше

![](eda/Распределение_battery_power_по_price_range.png 'Зависимость цены телефона от мощности батареи')

- Телефоны с более мощной батареей имеют стоимость выше

![](eda/Heatmap.png 'Тепловая карта')

- Наблюдаем очевидную корреляцию между ценой и батареей, ценой и ОЗУ, ценой и плостью пикселей
- Так же есть корреляция между мегапикселями основной и фронтальной камеры
- В выборке сбалансировано представлены телефоны всех ценовых категорий.


# Запуск MLFlow

1. Перейти в директорию mlflow
```
cd mlflow
```

2. Выполинть в терминале следующую команду
```
source start_mlflow.sh
```

# Исследование

Лучший результат показала модель на основе sklearn RFE (rfe_feature_selection):

- В качестве средства оценки - RandomForestClassifier
- Количество объектов оценки - 12
- Шаг - 12

Метрики лучшего прогона:
- precision: 1
- recall: 1
- f1: 1
```
run_id = "542d03a28f6b465fa07070011e4928a8"
```

# Скриншот всех прогонов и их графиков с метриками качества.
![](research/Метрики.png)
# Скриншот зарегистрированных версий моделей
![](research/Зарегистрированные_модели.png)


# Мониторинг

В данном разделе был настроен веб-интерфейс Prometheus для сбора и хранения метрик, которые генерируются различными сервисами. Конфигурационный файл и скриншоты, полученные в процессе настройки, сохраняются в папке ```/services/prometheus```. Доступ к веб-интерфейсу осуществляется через адрес ```http://localhost:9090```.

В ходе тестирования интерфейса были получены следующие изображения:

- Гистограмма предсказаний модели  
![prom_hist](/services/prometheus/Гистограмма_предсказаний_модели.png)

- Частота запросов к основному сервису  
![prom_rate](/services/prometheus/Количество_запросов_к_сервису_с_кодами_ошибок.png)

- Количество запросов с ошибками 4** и 5**  
![prom_error](/services/prometheus/Частота_запросов_к_основному_сервису.png)

# Дашборд

На заключительном этапе был создан сервис Grafana.

Этот сервис используется для визуализации метрик с помощью создания дашбордов. Результирующий дашборд хранится в папке ```/services/grafana```. Веб-интерфейс доступен по адресу ```http://localhost:3000```, а в качестве базы данных используется Prometheus.

![Grafana Dashboard](/services/grafana/Дашборд.png)

Описание метрик, отображённых на дашборде:

1. **prediction_histogram_bucket**  
   Гистограмма, показывающая распределение предсказаний модели по классам. Она помогает определить, какие классы модель предсказывает чаще всего. Четыре цвета на гистограмме соответствуют четырём категориям цен телефонов.  
   Уровень мониторинга: Качество работы модели.

2. **process_cpu_seconds_total**  
   Временной ряд, отображающий общее время, которое процессор потратил на выполнение задач. Это помогает оценить нагрузку на процессор.  
   Уровень мониторинга: Инфраструктурный уровень.

3. **prediction_request_latency_seconds_count**  
   Диаграмма, показывающая количество измерений времени обработки запросов на предсказание. Полезна для анализа задержек в обработке запросов.  
   Уровень мониторинга: Прикладной уровень.

4. **model_data_shift**  
   Индикатор, который отслеживает сдвиг входных данных по сравнению с данными, использовавшимися для обучения модели. Это может повлиять на точность предсказаний модели.  
   Уровень мониторинга: Качество работы модели.

5. **model_accuracy**  
   Индикатор, показывающий точность предсказаний модели.  
   Уровень мониторинга: Качество работы модели.

6. **prediction_requests_total**  
   Временной ряд, показывающий количество запросов, полученных моделью.  
   Уровень мониторинга: Прикладной уровень.

# Итоговая команда для запуска Compose-проекта

``` docker build . --tag mobile_classifier_model:2 ```

``` docker compose up ```
